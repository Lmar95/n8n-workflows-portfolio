{
  "name": "Cr√©ation Automatique Supports Commerciaux Personnalis√©s",
  "nodes": [
    {
      "parameters": {
        "content": "## üìä Supports Commerciaux Automatis√©s\n\n**Objectif:** G√©n√©rer des supports de vente personnalis√©s (one-pagers, pitch decks, case studies) adapt√©s √† chaque prospect.\n\n**D√©clencheur:** Webhook POST avec donn√©es prospect + type de support\n\n**Variables requises:**\n- OPENAI_API_KEY\n- HUBSPOT_API_KEY\n- NOTION_API_KEY\n- SENDGRID_API_KEY",
        "height": 220,
        "width": 360
      },
      "id": "sticky-1",
      "name": "Documentation",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [0, 0]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "create-sales-material",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Demande Support",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [440, 300],
      "webhookId": "sales-material-webhook"
    },
    {
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{ "name": "Authorization", "value": "Bearer {{$vars.OPENAI_API_KEY}}" }]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "model", "value": "gpt-4-turbo-preview" },
            {
              "name": "messages",
              "value": "=[{\"role\":\"system\",\"content\":\"Tu es consultant commercial senior. Tu cr√©es des supports de vente percutants et personnalis√©s qui acc√©l√®rent les cycles de vente.\"},{\"role\":\"user\",\"content\":\"Cr√©e un \" + $json.type_support + \" personnalis√© pour:\\n\\nProspect: \" + $json.nom_prospect + \"\\nEntreprise: \" + $json.entreprise + \"\\nSecteur: \" + ($json.secteur || '') + \"\\nProbl√®me principal: \" + ($json.probleme || '') + \"\\nObjectif business: \" + ($json.objectif || '') + \"\\nBudget estim√©: \" + ($json.budget || 'Non sp√©cifi√©') + \"\\n\\nNotre offre: \" + ($json.notre_offre || process.env.DEFAULT_OFFER || 'Solution SaaS B2B') + \"\\nNos r√©f√©rences secteur: \" + ($json.references || '') + \"\\n\\nType de support: \" + $json.type_support + \"\\n\\nPour un 'one-pager': titre accrocheur, probl√®me/solution, 3 b√©n√©fices cl√©s, ROI estim√©, CTA\\nPour un 'pitch-deck': 8 slides (contexte, probl√®me, solution, produit, cas clients, ROI, √©quipe, prochaine √©tape)\\nPour un 'case-study': situation initiale, d√©fis, solution mise en place, r√©sultats mesurables, t√©moignage\\n\\nRetourne en JSON avec 'contenu' (le support complet) et 'objet_email' (pour l'envoi).\"}]"
            },
            { "name": "max_tokens", "value": "2000" },
            { "name": "response_format", "value": "={\"type\":\"json_object\"}" }
          ]
        }
      },
      "id": "generate-material",
      "name": "GPT-4 G√©n√®re Support",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst request = $node['Webhook Demande Support'].first().json;\n\nlet material;\ntry {\n  material = JSON.parse(response.choices[0].message.content);\n} catch (e) {\n  material = { contenu: response.choices[0].message.content, objet_email: 'Support commercial' };\n}\n\n// G√©n√©rer HTML du support\nconst htmlContent = `<!DOCTYPE html>\n<html lang=\"fr\">\n<head>\n<meta charset=\"UTF-8\">\n<style>\n  body { font-family: 'Helvetica Neue', sans-serif; max-width: 800px; margin: 0 auto; color: #1a1a2e; }\n  .header { background: linear-gradient(135deg, #16213e, #0f3460); color: white; padding: 40px; border-radius: 12px; margin-bottom: 24px; }\n  .header h1 { font-size: 2em; margin-bottom: 8px; }\n  .section { background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 24px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }\n  .highlight { background: #e8f4fd; border-left: 4px solid #0f3460; padding: 16px; border-radius: 0 8px 8px 0; margin: 16px 0; }\n  .metric { display: inline-block; background: #0f3460; color: white; padding: 8px 16px; border-radius: 20px; margin: 4px; font-weight: bold; }\n</style>\n</head>\n<body>\n<div class=\"header\">\n  <h1>Support Personnalis√© pour ${request.entreprise}</h1>\n  <p>Pr√©par√© sp√©cialement pour ${request.nom_prospect} | ${new Date().toLocaleDateString('fr-FR')}</p>\n</div>\n<div class=\"section\">\n  <pre style=\"white-space: pre-wrap; font-family: inherit;\">${material.contenu}</pre>\n</div>\n</body>\n</html>`;\n\nreturn [{\n  json: {\n    ...request,\n    material,\n    htmlContent,\n    objetEmail: material.objet_email,\n    dateCreation: new Date().toISOString()\n  }\n}];"
      },
      "id": "build-support",
      "name": "Construire Support HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [920, 300]
    },
    {
      "parameters": {
        "url": "https://api.sendgrid.com/v3/mail/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{ "name": "Authorization", "value": "Bearer {{$vars.SENDGRID_API_KEY}}" }]
        },
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={\"personalizations\": [{\"to\": [{\"email\": \"{{ $json.email_commercial }}\", \"name\": \"Commercial\"}]}], \"from\": {\"email\": \"{{$vars.SALES_EMAIL}}\", \"name\": \"Syst√®me Commercial\"}, \"subject\": \"Support pr√™t: {{ $json.type_support }} pour {{ $json.entreprise }}\", \"content\": [{\"type\": \"text/html\", \"value\": \"{{ $json.htmlContent }}\"}]}"
      },
      "id": "send-to-commercial",
      "name": "Envoyer au Commercial",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1160, 300]
    },
    {
      "parameters": {
        "url": "https://api.notion.com/v1/pages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Authorization", "value": "Bearer {{$vars.NOTION_API_KEY}}" },
            { "name": "Notion-Version", "value": "2022-06-28" }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={\"parent\": {\"database_id\": \"{{$vars.NOTION_DB_SUPPORTS_ID}}\"}, \"properties\": {\"Titre\": {\"title\": [{\"text\": {\"content\": \"{{ $json.type_support }} - {{ $json.entreprise }}\"}}]}, \"Type\": {\"select\": {\"name\": \"{{ $json.type_support }}\"}}, \"Prospect\": {\"rich_text\": [{\"text\": {\"content\": \"{{ $json.entreprise }}\"}}]}, \"Date\": {\"date\": {\"start\": \"{{ $json.dateCreation }}\"}}}, \"children\": [{\"object\": \"block\", \"type\": \"paragraph\", \"paragraph\": {\"rich_text\": [{\"text\": {\"content\": \"{{ $json.material.contenu.slice(0, 1800) }}\"}}]}}]}"
      },
      "id": "save-notion",
      "name": "Archiver Notion",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1160, 460]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true, \"type\": \"{{ $json.type_support }}\", \"prospect\": \"{{ $json.entreprise }}\", \"message\": \"Support cr√©√© et envoy√©\"}"
      },
      "id": "webhook-response",
      "name": "R√©ponse",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1400, 380]
    }
  ],
  "connections": {
    "Webhook Demande Support": { "main": [[{ "node": "GPT-4 G√©n√®re Support", "type": "main", "index": 0 }]] },
    "GPT-4 G√©n√®re Support": { "main": [[{ "node": "Construire Support HTML", "type": "main", "index": 0 }]] },
    "Construire Support HTML": {
      "main": [[
        { "node": "Envoyer au Commercial", "type": "main", "index": 0 },
        { "node": "Archiver Notion", "type": "main", "index": 0 }
      ]]
    },
    "Envoyer au Commercial": { "main": [[{ "node": "R√©ponse", "type": "main", "index": 0 }]] }
  },
  "settings": { "executionOrder": "v1" },
  "tags": [{ "name": "vente" }, { "name": "supports" }, { "name": "commercial" }]
}
