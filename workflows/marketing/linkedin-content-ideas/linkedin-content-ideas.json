{
  "name": "G√©n√©ration Id√©es Contenu LinkedIn et Calendrier √âditorial",
  "nodes": [
    {
      "parameters": {
        "content": "## üí° G√©n√©ration Id√©es Contenu LinkedIn\n\n**Objectif:** G√©n√©rer automatiquement 30 id√©es de posts LinkedIn par mois bas√©es sur les tendances, l'actualit√© secteur et la veille concurrentielle.\n\n**D√©clencheur:** 1er de chaque mois\n\n**Variables requises:**\n- OPENAI_API_KEY\n- NOTION_API_KEY\n- NEWSAPI_KEY\n- SLACK_WEBHOOK_URL",
        "height": 220,
        "width": 360
      },
      "id": "sticky-1",
      "name": "Documentation",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [0, 0]
    },
    {
      "parameters": {
        "rule": { "interval": [{ "field": "cronExpression", "expression": "0 8 1 * *" }] }
      },
      "id": "monthly-trigger",
      "name": "1er du Mois",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [440, 300]
    },
    {
      "parameters": {
        "url": "https://newsapi.org/v2/top-headlines",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            { "name": "apiKey", "value": "={{$vars.NEWSAPI_KEY}}" },
            { "name": "q", "value": "={{$vars.SECTEUR_KEYWORDS || 'startup technology innovation'}}" },
            { "name": "language", "value": "fr" },
            { "name": "pageSize", "value": "20" }
          ]
        }
      },
      "id": "fetch-news",
      "name": "Actualit√©s Secteur",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 200]
    },
    {
      "parameters": {
        "jsCode": "const newsData = $node['Actualit√©s Secteur'].first().json;\nconst articles = newsData.articles || [];\n\nconst newsTitles = articles\n  .slice(0, 10)\n  .map(a => `- ${a.title}`)\n  .join('\\n');\n\nreturn [{ json: { newsTitles } }];"
      },
      "id": "process-news",
      "name": "Pr√©parer Contexte",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [920, 300]
    },
    {
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{ "name": "Authorization", "value": "Bearer {{$vars.OPENAI_API_KEY}}" }]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "model", "value": "gpt-4-turbo-preview" },
            {
              "name": "messages",
              "value": "=[{\"role\":\"system\",\"content\":\"Tu es expert en personal branding et content marketing LinkedIn. G√©n√®re des id√©es de posts engageants qui cr√©ent de la valeur.\"},{\"role\":\"user\",\"content\":\"G√©n√®re 30 id√©es de posts LinkedIn pour le mois prochain pour une entreprise dans le secteur: \" + (process.env.SECTEUR || 'B2B SaaS') + \"\\n\\nActualit√©s r√©centes du secteur:\\n\" + $json.newsTitles + \"\\n\\nPour chaque id√©e fournis:\\n- Titre accrocheur\\n- Format (carrousel, texte, vid√©o, sondage, article)\\n- Hook d'ouverture (1 phrase)\\n- Semaine sugg√©r√©e (1 √† 4)\\n- Angle (expertise, t√©moignage, behind the scenes, opinion, √©ducatif)\\n\\nMixe les formats et angles. Retourne un JSON avec un array 'posts'.\"}]"
            },
            { "name": "max_tokens", "value": "3000" },
            { "name": "response_format", "value": "={\"type\":\"json_object\"}" }
          ]
        }
      },
      "id": "generate-ideas",
      "name": "GPT-4 G√©n√®re 30 Id√©es",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1160, 300]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nlet posts;\ntry {\n  const content = JSON.parse(response.choices[0].message.content);\n  posts = content.posts || [];\n} catch (e) {\n  posts = [];\n}\n\nconst month = new Date().toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });\n\n// Pr√©parer pour Notion - un item par post\nreturn posts.map((post, i) => ({\n  json: {\n    titre: post.titre || `Id√©e #${i+1}`,\n    format: post.format || 'Texte',\n    hook: post.hook || '',\n    semaine: post.semaine || Math.ceil((i+1)/7.5),\n    angle: post.angle || '√âducatif',\n    statut: 'Id√©e',\n    mois: month,\n    ordre: i + 1\n  }\n}));"
      },
      "id": "format-posts",
      "name": "Formater Posts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1400, 300]
    },
    {
      "parameters": {
        "url": "https://api.notion.com/v1/pages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Authorization", "value": "Bearer {{$vars.NOTION_API_KEY}}" },
            { "name": "Notion-Version", "value": "2022-06-28" }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={\"parent\": {\"database_id\": \"{{$vars.NOTION_DB_CONTENT_ID}}\"}, \"properties\": {\"Titre\": {\"title\": [{\"text\": {\"content\": \"{{ $json.titre }}\"}}]}, \"Format\": {\"select\": {\"name\": \"{{ $json.format }}\"}}, \"Angle\": {\"select\": {\"name\": \"{{ $json.angle }}\"}}, \"Semaine\": {\"number\": {{ $json.semaine }}}, \"Statut\": {\"select\": {\"name\": \"Id√©e\"}}, \"Hook\": {\"rich_text\": [{\"text\": {\"content\": \"{{ $json.hook }}\"}}]}, \"Mois\": {\"rich_text\": [{\"text\": {\"content\": \"{{ $json.mois }}\"}}]}}}"
      },
      "id": "save-to-notion",
      "name": "Sauvegarder Notion",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1640, 300]
    },
    {
      "parameters": {
        "url": "={{$vars.SLACK_WEBHOOK_URL}}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "=üìÖ *Calendrier √âditorial LinkedIn g√©n√©r√©!*\n\n30 id√©es de posts pour le mois prochain ont √©t√© cr√©√©es et ajout√©es √† Notion.\n\nRendez-vous dans votre base Notion Contenu pour les consulter et les planifier!"
            }
          ]
        }
      },
      "id": "slack-notify",
      "name": "Notification Slack",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1880, 300]
    }
  ],
  "connections": {
    "1er du Mois": { "main": [[{ "node": "Actualit√©s Secteur", "type": "main", "index": 0 }]] },
    "Actualit√©s Secteur": { "main": [[{ "node": "Pr√©parer Contexte", "type": "main", "index": 0 }]] },
    "Pr√©parer Contexte": { "main": [[{ "node": "GPT-4 G√©n√®re 30 Id√©es", "type": "main", "index": 0 }]] },
    "GPT-4 G√©n√®re 30 Id√©es": { "main": [[{ "node": "Formater Posts", "type": "main", "index": 0 }]] },
    "Formater Posts": { "main": [[{ "node": "Sauvegarder Notion", "type": "main", "index": 0 }]] },
    "Sauvegarder Notion": { "main": [[{ "node": "Notification Slack", "type": "main", "index": 0 }]] }
  },
  "settings": { "executionOrder": "v1" },
  "tags": [{ "name": "marketing" }, { "name": "linkedin" }, { "name": "content" }]
}
