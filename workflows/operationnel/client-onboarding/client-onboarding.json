{
  "name": "Onboarding Automatis√© Nouveaux Clients",
  "nodes": [
    {
      "parameters": {
        "content": "## üöÄ Onboarding Clients Automatis√©\n\n**Objectif:** Orchestrer tout le processus d'onboarding client: cr√©ation d'espace, invitation outils, envoi ressources, planification kick-off.\n\n**D√©clencheur:** Deal HubSpot pass√© en 'Closed Won' ou webhook\n\n**Variables requises:**\n- HUBSPOT_API_KEY\n- NOTION_API_KEY\n- SENDGRID_API_KEY\n- SLACK_BOT_TOKEN\n- CALENDLY_API_KEY",
        "height": 240,
        "width": 380
      },
      "id": "sticky-1",
      "name": "Documentation",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [0, 0]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "client-onboarding",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Deal Gagn√©",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [440, 300],
      "webhookId": "client-onboarding-webhook"
    },
    {
      "parameters": {
        "url": "https://api.hubapi.com/crm/v3/objects/deals/{{$json.dealId}}?properties=dealname,amount,closedate,hubspot_owner_id,hs_primary_contact_id",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{ "name": "Authorization", "value": "Bearer {{$vars.HUBSPOT_API_KEY}}" }]
        }
      },
      "id": "get-deal",
      "name": "R√©cup√©rer Deal HubSpot",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "url": "https://api.notion.com/v1/pages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Authorization", "value": "Bearer {{$vars.NOTION_API_KEY}}" },
            { "name": "Notion-Version", "value": "2022-06-28" }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={\"parent\": {\"database_id\": \"{{$vars.NOTION_DB_CLIENTS_ID}}\"}, \"properties\": {\"Client\": {\"title\": [{\"text\": {\"content\": \"{{ $('Webhook Deal Gagn√©').first().json.client_nom }}\"}}]}, \"Statut\": {\"select\": {\"name\": \"Onboarding\"}}, \"Date D√©marrage\": {\"date\": {\"start\": \"{{ new Date().toISOString().split('T')[0] }}\"}}, \"Montant\": {\"number\": {{ $json.properties.amount || 0 }}}, \"Commercial\": {\"rich_text\": [{\"text\": {\"content\": \"{{ $('Webhook Deal Gagn√©').first().json.commercial || '' }}\"}}]}}, \"children\": [{\"object\": \"block\", \"type\": \"heading_2\", \"heading_2\": {\"rich_text\": [{\"text\": {\"content\": \"üìã Checklist Onboarding\"}}]}}, {\"object\": \"block\", \"type\": \"to_do\", \"to_do\": {\"rich_text\": [{\"text\": {\"content\": \"Kick-off call planifi√©\"}}], \"checked\": false}}, {\"object\": \"block\", \"type\": \"to_do\", \"to_do\": {\"rich_text\": [{\"text\": {\"content\": \"Acc√®s outils configur√©s\"}}], \"checked\": false}}, {\"object\": \"block\", \"type\": \"to_do\", \"to_do\": {\"rich_text\": [{\"text\": {\"content\": \"Brief projet compl√©t√©\"}}], \"checked\": false}}]}"
      },
      "id": "create-client-notion",
      "name": "Cr√©er Espace Client Notion",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [920, 160]
    },
    {
      "parameters": {
        "url": "https://slack.com/api/channels.create",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{ "name": "Authorization", "value": "Bearer {{$vars.SLACK_BOT_TOKEN}}" }]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "name", "value": "=client-{{ $('Webhook Deal Gagn√©').first().json.client_nom.toLowerCase().replace(/[^a-z0-9]/g, '-').substring(0, 20) }}" },
            { "name": "is_private", "value": false }
          ]
        }
      },
      "id": "create-slack-channel",
      "name": "Cr√©er Canal Slack Client",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [920, 300]
    },
    {
      "parameters": {
        "url": "https://api.sendgrid.com/v3/mail/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{ "name": "Authorization", "value": "Bearer {{$vars.SENDGRID_API_KEY}}" }]
        },
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={\"personalizations\": [{\"to\": [{\"email\": \"{{ $('Webhook Deal Gagn√©').first().json.client_email }}\", \"name\": \"{{ $('Webhook Deal Gagn√©').first().json.client_nom }}\"}]}], \"from\": {\"email\": \"{{$vars.CSM_EMAIL}}\", \"name\": \"{{$vars.COMPANY_NAME}} - Customer Success\"}, \"subject\": \"Bienvenue! Votre onboarding commence üöÄ\", \"content\": [{\"type\": \"text/html\", \"value\": \"<h1>Bienvenue {{ $('Webhook Deal Gagn√©').first().json.client_prenom }} !</h1><p>Nous sommes ravis de vous compter parmi nos clients.</p><h2>Prochaines √©tapes</h2><ol><li><strong>Kick-off call</strong> - Planifiez notre premier √©change: <a href='{{$vars.CALENDLY_URL}}'>R√©server un cr√©neau</a></li><li><strong>Questionnaire d'onboarding</strong> - Pour que nous comprenions vos besoins: <a href='{{$vars.ONBOARDING_FORM_URL}}'>Remplir le questionnaire</a></li><li><strong>Acc√®s √† votre espace client</strong> - Nous vous enverrons vos acc√®s sous 24h</li></ol><p>Une question ? Votre contact d√©di√©: <a href='mailto:{{$vars.CSM_EMAIL}}'>{{$vars.CSM_NAME}}</a></p><p>√Ä tr√®s bient√¥t !<br>{{$vars.CSM_NAME}}<br>{{$vars.COMPANY_NAME}}</p>\"}]}"
      },
      "id": "welcome-email",
      "name": "Email Bienvenue Client",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [920, 440]
    },
    {
      "parameters": {
        "url": "={{$vars.SLACK_WEBHOOK_URL}}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "=üéâ *Nouveau client onboard√©!*\n\n*Client:* {{ $('Webhook Deal Gagn√©').first().json.client_nom }}\n*Montant:* {{ $json.properties?.amount || '' }} ‚Ç¨\n*Commercial:* {{ $('Webhook Deal Gagn√©').first().json.commercial || '' }}\n\n‚úÖ Espace Notion cr√©√©\n‚úÖ Canal Slack cr√©√©\n‚úÖ Email bienvenue envoy√©\n\nüìÖ √Ä planifier: Kick-off call dans les 48h"
            }
          ]
        }
      },
      "id": "notify-team",
      "name": "Notifier √âquipe",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1160, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true, \"client\": \"{{ $('Webhook Deal Gagn√©').first().json.client_nom }}\", \"actions\": [\"Notion cr√©√©\", \"Slack cr√©√©\", \"Email envoy√©\", \"√âquipe notifi√©e\"]}"
      },
      "id": "webhook-response",
      "name": "R√©ponse",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1400, 300]
    }
  ],
  "connections": {
    "Webhook Deal Gagn√©": { "main": [[{ "node": "R√©cup√©rer Deal HubSpot", "type": "main", "index": 0 }]] },
    "R√©cup√©rer Deal HubSpot": {
      "main": [[
        { "node": "Cr√©er Espace Client Notion", "type": "main", "index": 0 },
        { "node": "Cr√©er Canal Slack Client", "type": "main", "index": 0 },
        { "node": "Email Bienvenue Client", "type": "main", "index": 0 }
      ]]
    },
    "Cr√©er Canal Slack Client": { "main": [[{ "node": "Notifier √âquipe", "type": "main", "index": 0 }]] },
    "Notifier √âquipe": { "main": [[{ "node": "R√©ponse", "type": "main", "index": 0 }]] }
  },
  "settings": { "executionOrder": "v1" },
  "tags": [{ "name": "operationnel" }, { "name": "clients" }, { "name": "onboarding" }]
}
